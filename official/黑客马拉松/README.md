# 黑客马拉松

题解作者：[emc2314](https://github.com/emc2314/)

出题人、验题人、文案设计等：见 [Hackergame 2023 幕后工作人员](https://hack.lug.ustc.edu.cn/credits/)。

## 题目描述

- 题目分类：math

- 题目分值：教练，有人抢跑！（300）+ 一発勝負（250）

听闻今年 Hackergame 增加了黑客马拉松作为线下的决赛内容，对 Hackathon 这种头脑风暴式的编程大赛倍感兴趣的 Z 同学，毅然结束了在夏威夷的悠长假期，踏上了前往中科大的旅程。

只是——

---

> ## 《关于举行 2023 年中国科学技术大学黑客马拉松大赛的通知》
>
> 为深入贯彻新时代中国特色社会主义思想，全面实施创新驱动发展战略，以实际行动响应国家节能减排和低碳出行的政策号召，提升我校黑客社团的活动质量和层次，打造一流高水平黑客团队，我校决定举行 2023 年中国科学技术大学黑客马拉松大赛。
>
> 本次比赛秉持“低碳、自主、多元”的精神，立足于传统的马拉松之外，增加了如下两条比赛规则：
>
> - 为了充分发挥学生主观能动性，培养学生独立思考的能力，马拉松起点可由选手自由选择。选手可根据自身身体条件与环境偏好，寻找最适合自己运动的比赛起点，为绿色地球贡献一份自己的力量。
>
> - 为了展现比赛的多样性与公平性，马拉松终点由主办方使用密码学安全的随机数生成器随机生成。这种赛程的不确定在要求选手挑战自我的同时，也激发他们面对未知挑战时的决心和勇气，更好的培养他们在瞬息万变的社会环境中以实际行动践行低碳生活。
>
> 这是我校首次以黑客马拉松为平台，发挥学生的创新精神，推动信息科技发展的大规模活动。希望广大同学积极参与，以赛促学，学以致用，营造积极向上，富有创新精神和环保意识的校园文化氛围。
>
> 请各级领导、相关部门及同学们予以关注，对此次活动给予足够的重视和支持，为我校的创新发展和校园建设注入更多活力。
>
> 中国科学技术大学 Linux 用户协会
>
> 2023 年 10 月 28 日

千里迢迢赶来报名参加黑客马拉松的 Z 同学低头看着手里的比赛通知，陷入了沉思。

「怎么感觉、好像、似乎、这个黑客马拉松、它不需要写代码？」Z 同学看着坐在报名点前一脸无辜的主办方同学。

「那当然啦，我们比赛是要响应低碳出行绿色生活的，肯定不会用到计算机嘛……」

「所以说你们这比赛是真得要跑马拉松吗？这是哪门子的黑客马拉松啊喂！」

「是面向黑客举办的马拉松呀，整天坐在电脑前，晚上凌晨三四点还在提交 flag 多不健康啊。这倒也就罢了，有些人做不出来 flag 也要去熬夜，很容易引发心血管疾病的……」

「好了你别说了，我高血压已经开始犯了」

「那既然这样，就更应该参加我们的健康绿色的黑客马拉松嘛」主办方同学满眼真诚，顿了顿又补充道：「来都来了。」

仿佛吃了一记夺魂咒，Z 同学若有所悟地重复道：「是啊，来都来了……」

---

第二天

「预备、开始！」

随着广播里的裁判一声令下，选手们纷纷已经到达终点。

「咦好奇怪哦，为什么他们自选的起点就是给他们分配的终点鸭」主办方同学看着最终成绩排行榜上的一堆“00:00:00.00”，非常疑惑。

「诶喂别跑了，就剩你一个了，已经结束啦，虽然很遗憾没有能够取得让大家都满意的结果」热心的主办方及时叫住刚跑出没两步远的 Z 同学。

「怎么回事，有人抢跑？」Z 同学还有点不知情况。

「抢跑的话……他们提前两天就把起点给选好了，而且位置还好巧不巧和今天才给他们安排的终点重合，算抢跑吗？」主办方同学指着排行榜和 Z 同学说。

「这明明就是你们终点的分配方案被提前知道了吧喂！」

「你说的对，但是终点的位置是由我校 Hackergame 团队自主研发的一款基于 RSA 的密码学安全的随机数生成器生成的鸭？」主办方同学可爱地眨了眨眼，并且强调说，「而且设计上已经考虑到我们少年班学院的同学都会心算大整数分解了！」

「没关系，我已经知道了」Z 同学热泪盈眶地拍了拍主办方同学的肩膀，「真正的黑客马拉松现在才刚刚开始。」


## 题目信息

- [题目附件下载](files/rsa_prng.py)
- 你可以通过 `nc 202.38.93.111 20230` 来连接题目，或者点击下面的「打开/下载题目」按钮通过网页终端与远程交互。

> 如果你不知道 `nc` 是什么，或者在使用上面的命令时遇到了困难，可以参考我们编写的 [萌新入门手册：如何使用 nc/ncat？](https://lug.ustc.edu.cn/planet/2019/09/how-to-use-nc/)
## 题解

这道题源自于之前学密码学时一直存在的一些疑惑：首先是为什么没怎么听说过密码学安全的随机数发生器（CSPRNG）算法的名字？有很多著名的 PRNG 算法，除去 LCG、MT19937，还有一些 xorshift 系列和 PCG 系列的算法，但是他们都不是密码学安全的。我们也知道很多签名算法，比如 ECDSA、Schnorr，还有很多对称加密的算法，比如 DES、AES、Twofish，我们也听说过很多 Hash 算法的名字，比如 MD5、SHA-1、SHA256、SHA-3 等等。许多密码学算法都是通过长年的比赛而选出来的，比如 AES、SHA-3、AEGIS-128、Salsa-20、Argon2、CRYSTALS-Kyber 等等。但是我们似乎从未见过设计 CSPRNG 的比赛，以至于在现实中似乎大家都在想当然的实现自己的版本，比如 Linux kernel 在 4.8 版本之前使用了一个自制的 TGFSR 作为 Mixing Function，然后使用 SHA-1 构造了一个 Feedback-Extract 的结构来产生输出。

当然我们知道，一个安全的 stream cipher 就是天然的一个 CSPRNG。除此之外，使用 block cipher 的 counter mode 也可以产生安全的随机数，这在 NIST SP 800-90A 中被称为 CTR_DRBG。这个标准中还提出了 HMAC_DRBG 和 HASH_DRBG。这里留下一个思考题：为什么不使用 HASH_DRBG 来做 stream cipher 呢？如果是因为 HASH_DRBG 太慢的话，为什么实践中不使用安全的 stream cipher 来产生随机数而要制定这些 DRBG 标准呢？

[UNDER CONSTRUCTION]
Exp 见 [src 文件夹](./src/)